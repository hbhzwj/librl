#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\use_hyperref false
\papersize default
\use_geometry false
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset Formula $\mu_{\theta}\left(u_{i}\mid x\right)=\frac{a_{i}(\theta)}{\sum a_{i}(\theta)}$
\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\ln\mu_{\theta}\left(u_{i}\mid x\right)=\ln a_{i}(\theta)-\ln\sum a_{i}(\theta)$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\frac{\partial}{\theta_{j}}\mu_{\theta}}{\mu_{\theta}}=\frac{\frac{\partial}{\theta_{j}}a_{i}(\theta)}{a_{i}(\theta)}-\frac{\sum_{i}\frac{\partial}{\theta_{j}}a_{i}(\theta)}{\sum a_{i}(\theta)}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $a_{i}\mbox{\left(\theta\right)}=e^{\sum\theta_{j}f_{ij}}$
\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\frac{\partial}{\theta_{j}}a_{i}(\theta)=\theta_{j}e^{\sum\theta_{j}f_{ij}}=\theta_{j}a_{i}(\theta)$
\end_inset


\end_layout

\begin_layout Standard
so the first order derivative is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\frac{\partial}{\theta_{j}}\mu_{\theta}}{\mu_{\theta}}=\theta_{j}-\frac{\sum_{i}\theta_{j}a_{i}(\theta)}{\sum a_{i}(\theta)}
\]

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\[
\nabla\ln\mu_{\theta}\left(u_{i}\mid x\right)=\frac{\nabla a_{i}(\theta)}{a_{i}(\theta)}-\frac{\sum\nabla a_{i}(\theta)}{\sum a_{i}(\theta)}
\]

\end_inset


\end_layout

\begin_layout Standard
New method
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{eqnarray*}
\nabla^{2}\ln\mu_{\theta}\left(u_{i}\mid x\right) & = & \frac{a_{i}(\theta)\nabla^{2}a_{i}(\theta)-\nabla a_{i}(\theta)\nabla^{T}a_{i}(\theta)}{a_{i}^{2}(\theta)}-\frac{\sum a_{i}(\theta)\sum\nabla^{2}a_{i}(\theta)-\sum\nabla a_{i}(\theta)\sum\nabla^{T}a_{i}(\theta)}{\left(\sum a_{i}(\theta)\right)^{2}}\\
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $a_{i}\mbox{\left(\theta\right)}=e^{\theta^{T}f_{i}}$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\nabla a_{i}\left(\theta\right)=a_{i}(\theta)\theta$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\nabla^{2}a_{i}\left(\theta\right)=\theta\nabla^{T}a_{i}(\theta)+a_{i}(\theta)*I$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\partial a_{i}\left(\theta\right)}{\partial_{a}\partial_{b}}=\frac{\partial}{\partial_{b}}a_{i}(\theta)\theta_{a}=\theta_{a}\frac{\partial}{\partial_{b}}a_{i}(\theta)+a
\]

\end_inset


\end_layout

\begin_layout Section
Old Derivative
\end_layout

\begin_layout Standard
We can get:
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{eqnarray*}
\nabla\mu_{\theta}\left(u_{i}\mid x\right) & = & \mu_{\theta}\left(u_{i}\mid x\right)\left(\frac{\nabla a_{i}(\theta)}{a_{i}(\theta)}-\frac{\sum\nabla a_{i}(\theta)}{\sum a_{i}(\theta)}\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{eqnarray*}
\nabla^{2}\mu_{\theta}\left(u_{i}\mid x\right) & = & \nabla\mu_{\theta}\left(u_{i}\mid x\right)\nabla\ln\mu_{\theta}\left(u_{i}\mid x\right)\\
 & + & \mu_{\theta}\left(u_{i}\mid x\right)\nabla^{2}\ln\mu_{\theta}\left(u_{i}\mid x\right)\\
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{eqnarray*}
\frac{\nabla^{2}\mu_{\theta}\left(u_{i}\mid x\right)}{\mu_{\theta}\left(u_{i}\mid x\right)} & = & \left(\nabla\ln\mu_{\theta}\left(u_{i}\mid x\right)\right)^{2}+\nabla^{2}\ln\mu_{\theta}\left(u_{i}\mid x\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\frac{\nabla^{2}\mu_{\theta}\left(u_{i}\mid x\right)}{\mu_{\theta}\left(u_{i}\mid x\right)}=
\]

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{eqnarray*}
\nabla\mu_{\theta}\left(u_{i}\mid x\right) & = & \frac{\sum a_{i}(\theta)\nabla a_{i}(\theta)-\sum\nabla a_{i}(\theta)a_{i}(\theta)}{\left(\sum a_{i}(\theta)\right)^{2}}\\
 & = & \frac{\nabla a_{i}(\theta)}{\sum a_{i}(\theta)}-\frac{\sum\nabla a_{i}(\theta)a_{i}(\theta)}{\left(\sum a_{i}(\theta)\right)^{2}}
\end{eqnarray*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\frac{\partial}{\partial\theta_{i}}\mu_{\theta}\left(u_{i}\mid x\right)=$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{eqnarray*}
\nabla\pi^{T}\left(\nabla g+\nabla Pv\right) & = & \nabla\pi^{T}\left(\nabla\mu g+\nabla\mu Pv\right)\\
 & = & \nabla\pi^{T}\left(\nabla\mu\left(g+Pv\right)\right)\\
 & = & \pi^{T}\mu\left(\frac{\nabla\mu\nabla\mu}{\mu^{2}}\left(g+Pv\right)\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Plain Layout
which means:
\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\[
\nabla\pi^{T}(x)=-\frac{\nabla\mu(x)}{\mu(x)}\pi^{T}(x)
\]

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\eta_{\theta}\mbox{\left(x,u\right)=1}$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\pi_{\theta}(x)\mu_{\theta}(u\mid x)=1$
\end_inset


\end_layout

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sum_{x,u}\left(\nabla\pi_{\theta}(x)\mu_{\theta}(u\mid x)+\pi_{\theta}(x)\nabla\mu_{\theta}(u\mid x)\right)=0$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\left(\nabla\pi_{\theta}(x)\mu_{\theta}(u\mid x)\right)=-\sum_{x,u}\left(\pi_{\theta}(x)\nabla\mu_{\theta}(u\mid x)\right)$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\eta_{\theta}\left(x,u\right)V_{\theta}=C$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\eta_{\theta}\left(x,u\right)V_{\theta}=C$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\left(\nabla\pi_{\theta}(x)\mu_{\theta}(u\mid x)V_{\theta}(x,u)\right)=-\sum_{x,u}\left(\pi_{\theta}(x)\nabla\mu_{\theta}(u\mid x)V_{\theta}(x,u)\right)$
\end_inset


\end_layout

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sum_{x,u}\left(\nabla\pi_{\theta}(x)\mu_{\theta}(u\mid x)V_{\theta}(x,u)+\pi_{\theta}(x)\nabla\mu_{\theta}(u\mid x)V_{\theta}(x,u)\right)=0$
\end_inset


\end_layout

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sum_{x,u}\left(\left(\nabla\pi_{\theta}(x)\mu_{\theta}(u\mid x)+\pi_{\theta}(x)\nabla\mu_{\theta}(u\mid x)\right)V_{\theta}(x,u)\right)=0$
\end_inset


\end_layout

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sum_{x,u}\left(\nabla\eta_{\theta}\left(x\mid u\right)V_{\theta}(x,u)\right)=0$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{eqnarray*}
V_{\theta}(x,u) & = & \frac{\nabla\mu\left(u\mid x\right)}{\mu\left(u\mid x\right)}\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\\
 & = & \psi_{\theta}\left(u\mid x\right)Q_{\theta}\left(x,u\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sum_{x,u}\left(\nabla\eta_{\theta}\left(x\mid u\right)\psi_{\theta}\left(u\mid x\right)Q_{\theta}\left(x,u\right)\right)=0$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\sum_{x,u}\left(\eta_{\theta}\left(x\mid u\right)\psi_{\theta}\left(u\mid x\right)Q_{\theta}\left(x,u\right)\right)=\nabla\alpha\left(\theta\right)$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{eqnarray*}
\nabla\pi^{T}\left(\nabla\mu\left(g+Pv\right)\right) & = & \sum_{x}\nabla\pi_{\theta}(x)\left(\sum_{u}\nabla\mu\left(u\mid x\right)\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\right)\\
 & = & \sum_{x,u}\nabla\pi_{\theta}(x)\nabla\mu\left(u\mid x\right)\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\\
 & = & \sum_{x,u}\nabla\pi_{\theta}(x)\mu\left(u\mid x\right)\frac{\nabla\mu\left(u\mid x\right)}{\mu\left(u\mid x\right)}\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\\
 & = & \sum_{x,u}\pi_{\theta}(x)\nabla\mu\left(u\mid x\right)\frac{\nabla\mu\left(u\mid x\right)}{\mu\left(u\mid x\right)}\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\\
 & = & -\sum_{x,u}\pi_{\theta}(x)\mu\left(u\mid x\right)\frac{\nabla\mu\left(u\mid x\right)\nabla^{T}\mu\left(u\mid x\right)}{\mu^{2}\left(u\mid x\right)}\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)\\
 & \mathbf{} & -\sum_{x,u}\eta_{\theta}\left(x,u\right)\frac{\nabla\mu\left(u\mid x\right)\nabla^{T}\mu\left(u\mid x\right)}{\mu^{2}\left(u\mid x\right)}\left(g(x,u)+\sum_{y}p(y\mid x)v_{\theta}(y)\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula $\nabla\pi^{T}=\nabla\pi^{T}$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\pi P=\pi$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\nabla\pi$
\end_inset


\begin_inset Formula $\left(P-I\right)+\pi\nabla P=0$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
